---
- hosts: 127.0.0.1
  connection: local
  become: yes
  roles:
    ### Handlers
    - { role: 'handlers' }
    ### Provision
    - { role: 'chores/centos/epel_repository' }
    - { role: 'chores/centos/install_base_packages' }
    - { role: 'packages/common/yarn' }
    - { role: 'chores/centos/set_timezone' }
    - { role: 'user/centos' }
    ### Services
    - { role: 'chores/common/hostname' }
    - { role: 'packages/centos/fullstaq-ruby', ruby_versions: ['fullstaq-ruby-2.6.6', 'fullstaq-ruby-2.7.1'] }
    - { role: 'services/centos/monit', monit_services: ['sshd', 'cron', 'disk-usage'] }
    - { role: 'services/centos/memcached' }
    - { role: 'services/centos/nginx' }
    # - { role: 'services/centos/postgresql_server' }
    - { role: 'services/centos/postgresql_client' }
    - { role: 'services/centos/redis_server', redis_user: participa_decidim }
    ### Site
    - { role: 'sites/decidim' }
    - { role: 'tools/deploy' }
  vars:
    app_id: decidim
    app_git_branch: staging
    app_group: www-data
    app_repo_url: "https://gesfuentes.admon-cfnavarra.es/git/r/presidencia/WebParticipacionCiudadana.git"
    app_user: participa_decidim
    backup_databases:
      - decidim
    backups_folder: /backup
    backups_user: participa_decidim
    databases:
      - decidim
    env: staging
    geocoder_lookup_app_code:
    geocoder_lookup_app_id:
    hostname: decidim-navarra-staging
    include_passenger: true
    memcache_listen_address: "127.0.0.1"
    memcache_memory: 256
    postgres_bind_address: "127.0.0.1"
    postgres_version: 11
    rails_env: staging
    rbenv_user: participa_decidim
    redis_bind_address: "127.0.0.1"
    redis_url: redis://127.0.0.1:6379/0
    rollbar_access_token:
    sites_domains:
      - preparticipa.navarra.es
    ssl_certificate_name: decidim
    ansible_python_interpreter: /usr/bin/python
    epel_repo_url: "https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm"
    epel_repo_gpg_key_url: "https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7"
    epel_repofile_path: "/etc/yum.repos.d/epel.repo"
    populate_user: participa_decidim
    populate_user_password:
    site_db_name:
    site_db_user:
    site_db_host:
    site_db_port:
    site_db_password:
