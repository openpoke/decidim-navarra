# @title_es Instalar postgres para Centos/RH
# @title_en Install postgres for Centos/RH
# @input yum-config-manager --add-repo=#{package>name}
- name: Install the CentOS 7 postgres yum repo
  become: true
  package:
    name: https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
    state: present

# @title_es AÃ±adir repositorio SCL
# @title_en Add SCL repository
# @input yum-config-manager --add-repo #{yum_repository>baseurl}
- name: Add SCL repository
  yum_repository:
    name: rhscl
    description: rhscl repo
    baseurl: https://copr.fedoraproject.org/coprs/rhscl/centos-release-scl/repo/epel-7/rhscl-centos-release-scl-epel-7.repo
    enabled: yes

# @title_es Instalar paquetes necesarios para el cliente de postgresql 9.6
# @title_en Install necessary packages for the postgresql 9.6 client
# @input yum install -y #{with_items | join: ' '}
- name: Install PostgreSQL 9.6 client packages
  become: true
  package: name={{ item }} state=present
  with_items:
    - python-psycopg2
    - postgresql96-devel
    - postgresql96-libs
  when: postgres_version|string == "9.6"

# @title_es Instalar paquetes necesarios para el cliente de postgresql 11.0
# @title_en Install necessary packages for the postgresql 11.0 client
# @input yum install -y #{with_items | join: ' '}
- name: Install PostgreSQL 11.0 client packages
  become: true
  package: name={{ item }} state=present
  with_items:
    - llvm-toolset-7
    - centos-release-scl
    - python-psycopg2
    - postgresql11-devel
    - postgresql11-libs
  when: postgres_version|string == "11"

# @title_es Instalar paquetes necesarios para el cliente de postgresql 12.0
# @title_en Install necessary packages for the postgresql 12.0 client
# @input yum install -y #{with_items | join: ' '}
- name: Install PostgreSQL 12.0 client packages
  become: true
  package: name={{ item }} state=present
  with_items:
    - centos-release-scl-rh
    - python-psycopg2
    - postgresql12-devel
    - postgresql12-libs
  when: postgres_version|string == "12"
